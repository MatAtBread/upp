// Test transformation rule tracking
// This tests if rules registered by withReferences get re-evaluated on generated code

#include "io-lite.h"
@include(method.hup)

struct Point {
    int x;
    int y;
};

@method(struct Point) int getX(struct Point * self) {
    return self -> x;
}

@define testMacro() {
    // This macro generates code that contains a method call
    // The @method rule should detect and transform it
    return upp.code`
        struct Point p = {10, 20};
        int val = p.getX();
    `;
}

int main() {
    @testMacro()
    printf("%d\n", val);
    return 0;
}
