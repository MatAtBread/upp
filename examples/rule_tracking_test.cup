// Test transformation rule tracking
// This tests if rules registered by withReferences get re-evaluated on generated code

@include(method.hup)

struct Point {
    int x;
    int y;
};

@method(struct Point) int getX() {
    return this->x;
}

@define testMacro() {
    // This macro generates code that contains a method call
    // The @method rule should detect and transform it
    const code = upp.code(`
        Point p = {10, 20};
        int val = p.getX();
    `);

    return code.toString();
}

int main() {
    @testMacro()

    return 0;
}
